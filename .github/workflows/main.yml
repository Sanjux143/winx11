name: Build Winlator APK

on:
  workflow_dispatch: # Ye line allow karti hai ki tum manually "Run" button daba sako
  push:
    branches: [ "main" ] # Jab main branch me code push hoga tab bhi chalega

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. Code download karna (Submodules ke saath kyunki Winlator me Wine libraries hoti hai)
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        submodules: recursive
        fetch-depth: 0

    # 2. Java environment set karna (Winlator usually Java 17 use karta hai)
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    # 3. Gradle file ko executable permission dena
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    # 4. APK Build karna (Debug version taaki signing key ki zarurat na pade)
    - name: Build with Gradle
      run: ./gradlew assembleDebug --stacktrace

    # 5. Banaye hue APK ko upload karna taaki tum download kar sako
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: Winlator-APK
        path: app/build/outputs/apk/debug/*.apk
